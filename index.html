<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚‰é¸½å†’é™©</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        #skill-container {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 9999 !important;
            width: 90% !important;
            max-width: 1000px !important;
            background-color: rgba(10, 10, 25, 0.95) !important;
            box-shadow: 0 0 50px rgba(66, 99, 235, 0.7) !important;
            border: 2px solid rgba(66, 99, 235, 0.7) !important;
        }
        
        #skill-options {
            display: flex !important;
            justify-content: space-between !important;
            width: 100% !important;
            gap: 20px !important;
        }
        
        .skill-option {
            width: calc(33.33% - 20px) !important;
            max-width: 300px !important;
            min-width: 200px !important;
        }
    </style>
    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('JavaScripté”™è¯¯:', message);
            console.error('æ–‡ä»¶:', source);
            console.error('è¡Œå·:', lineno);
            console.error('åˆ—å·:', colno);
            console.error('é”™è¯¯å¯¹è±¡:', error);
            
            // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '0';
            errorDiv.style.left = '0';
            errorDiv.style.width = '100%';
            errorDiv.style.padding = '10px';
            errorDiv.style.backgroundColor = 'red';
            errorDiv.style.color = 'white';
            errorDiv.style.zIndex = '9999';
            errorDiv.textContent = `é”™è¯¯: ${message} (${source}:${lineno})`;
            document.body.appendChild(errorDiv);
            
            return true; // é˜»æ­¢é»˜è®¤é”™è¯¯å¤„ç†
        };
        
        // å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨æ¸¸æˆå®ä¾‹
        let gameInstance = null;
    </script>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <!-- æ¸¸æˆUI -->
        <div id="ui-container">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="top-bar">
                <!-- ç­‰çº§ -->
                <div class="status-group">
                    <div class="status-icon">â­</div>
                    <div id="level-info">ç­‰çº§: <span id="level">1</span></div>
                </div>
            </div>
            
            <!-- æ³¢æ¬¡ä¿¡æ¯ -->
            <div class="wave-info">
                æ³¢æ¬¡ <span id="wave-number">1</span>
                <div class="wave-timer">
                    <div class="wave-timer-fill"></div>
                </div>
            </div>
            
            <!-- æ¸¸æˆç»Ÿè®¡ -->
            <div class="stats-container">
                <div class="stats-item">æ—¶é—´: <span id="game-time" class="stats-value">00:00</span></div>
                <div class="stats-item">å‡»æ€: <span id="kill-count" class="stats-value">0</span></div>
                <div class="stats-item">å¾—åˆ†: <span id="score" class="stats-value">0</span></div>
            </div>
            
            <!-- ç»éªŒæ¡ -->
            <div class="exp-bar-container">
                <div class="exp-bar-fill" id="exp-fill"></div>
                <div class="exp-text">ç»éªŒ: <span id="exp-current">0</span>/<span id="exp-next">100</span></div>
            </div>
            
            <!-- æŠ€èƒ½é€‰æ‹©ç•Œé¢ -->
            <div id="skill-container" class="hidden" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999;">
                <h2>é€‰æ‹©ä¸€é¡¹æŠ€èƒ½</h2>
                <div id="skill-options"></div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="game-over" class="hidden">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>ä½ çš„åˆ†æ•°: <span id="final-score">0</span></p>
            <div class="stats-summary">
                <div class="stat-item">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-value" id="final-time">00:00</div>
                    <div class="stat-label">ç”Ÿå­˜æ—¶é—´</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ğŸ’€</div>
                    <div class="stat-value" id="final-kills">0</div>
                    <div class="stat-label">å‡»æ€æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">â­</div>
                    <div class="stat-value" id="final-level">1</div>
                    <div class="stat-label">æœ€ç»ˆç­‰çº§</div>
                </div>
            </div>
            <button id="restart-button">é‡æ–°å¼€å§‹</button>
        </div>
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen">
            <h1>è‚‰é¸½å†’é™©</h1>
            <p>åœ¨è¿™ä¸ªå±é™©çš„ä¸–ç•Œä¸­ç”Ÿå­˜ï¼Œå‡»è´¥æ•Œäººï¼Œæå‡ä½ çš„èƒ½åŠ›ã€‚æ¯æ¬¡å‡çº§å¯ä»¥é€‰æ‹©æ–°çš„æŠ€èƒ½ï¼Œåˆ›é€ ç‹¬ç‰¹çš„æ„å»ºã€‚</p>
            <div class="controls-info">
                <div class="control-item">
                    <div class="control-key">W A S D</div>
                    <div class="control-desc">ç§»åŠ¨è§’è‰²</div>
                </div>
                <div class="control-item">
                    <div class="control-key">ç©ºæ ¼</div>
                    <div class="control-desc">å†²åˆº</div>
                </div>
                <div class="control-item">
                    <div class="control-key">è‡ªåŠ¨</div>
                    <div class="control-desc">æ”»å‡»æœ€è¿‘çš„æ•Œäºº</div>
                </div>
            </div>
            <button id="start-button" onclick="startGameDirectly()">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>

    <!-- æ¸¸æˆè„šæœ¬ -->
    <script src="js/utils.js"></script>
    <script src="js/graphics.js"></script>
    <script src="js/entity.js"></script>
    <script src="js/player.js"></script>
    <script src="js/enemy.js"></script>
    <script src="js/projectile.js"></script>
    <script src="js/skills.js"></script>
    <script src="js/game.js"></script>
    
    <script>
        // ç›´æ¥åœ¨HTMLä¸­å®šä¹‰çš„å¼€å§‹æ¸¸æˆå‡½æ•°
        function startGameDirectly() {
            console.log("Start game directly called from inline script");
            if (gameInstance) {
                gameInstance.start();
            } else {
                console.error("Game instance not available");
            }
        }
        
        // ç¡®ä¿åœ¨é¡µé¢å®Œå…¨åŠ è½½ååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded");
            
            try {
                // åˆå§‹åŒ–æ¸¸æˆ
                gameInstance = new Game();
                
                // ç›‘å¬ç©å®¶æ”»å‡»äº‹ä»¶
                document.addEventListener('playerAttack', (e) => {
                    console.log("Player attack event triggered");
                    const projectile = e.detail.projectile;
                    gameInstance.addProjectile(projectile);
                });
                
                // ç›‘å¬ç©å®¶å‡çº§äº‹ä»¶
                document.addEventListener('playerLevelUp', () => {
                    console.log("Player level up event triggered");
                    gameInstance.handlePlayerLevelUp();
                });
                
                // ç›‘å¬æŠ•å°„ç‰©æ•ˆæœäº‹ä»¶
                document.addEventListener('projectileEffect', (e) => {
                    console.log("Projectile effect event triggered");
                    const effects = e.detail.effects;
                    if (Array.isArray(effects)) {
                        effects.forEach(effect => gameInstance.addEffect(effect));
                    } else {
                        gameInstance.addEffect(effects);
                    }
                });
                
                // ç›‘å¬æŠ•å°„ç‰©åˆ†è£‚äº‹ä»¶
                document.addEventListener('projectileSplit', (e) => {
                    console.log("Projectile split event triggered");
                    const splitProjectiles = e.detail.projectiles;
                    splitProjectiles.forEach(projectile => gameInstance.addProjectile(projectile));
                });
                
                // é‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
                document.getElementById('restart-button').addEventListener('click', function() {
                    console.log("Restart button clicked");
                    gameInstance.restart();
                });
                
            } catch (error) {
                console.error("Error initializing game:", error);
            }
        });
    </script>
</body>
</html> 